server {
    listen %ip%:%httpport%;
    listen %ip%:%httpsport% ssl;
    server_name %host% %aliases%;

    # Корневая папка проекта
    root 'C:\OpenServer\domains\42-fortune-react\build';

    # Указываем, что мы работаем с React приложением
    index index.html;
	
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Конфигурация для статических файлов
    location ~* \.(gif|jpg|jpeg|png|svg|css|js|ico)$ {
        expires max;
        log_not_found off;
    }

    # Отключаем доступ к скрытым файлам и папкам
    location ~ /\. {
        access_log off;
        log_not_found off;
        deny all;
    }

    # Отключаем доступ к файлам с расширением .htaccess
    location ~ /\.ht {
        deny all;
    }

    # Service configuration (do not edit!)
    # ----------------------------
    location /openserver/ {
        root      '%sprogdir%/modules/system/html';
        autoindex off;
        index     index.php index.html index.htm;
        %allow%allow all;
        allow 127.0.0.0/8;
        allow ::1/128;
        allow %ips%;
        deny all;
        location ~* ^/openserver/.+\.(?:css(\.map)?|js(\.map)?|jpe?g|png|gif|ico|cur|heic|webp|webm|svgz?|ttf|ttc|otf|eot|woff2?)$ {
            expires 1d;
            access_log off;
        }
        location /openserver/server-status {
            stub_status on;
        }
        location ~ ^/openserver/.*\.php$ {
            try_files      $fastcgi_script_name =404;
            fastcgi_index  index.php;
            fastcgi_pass   backend;
            include        '%sprogdir%/userdata/config/nginx_fastcgi_params.txt';
        }
    }
    # End service configuration
    # ----------------------------
}
